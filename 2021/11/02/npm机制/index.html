<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="npm机制, JavaScript html css">
    <meta name="description" content="true">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>npm机制 | null</title>
    <link rel="icon" type="image/x-icon, image/vnd.microsoft.icon" href="/favicon.ico">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 5.4.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="null" type="application/atom+xml">
</head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span"></span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name"></div>
        <div class="logo-desc">
            
            一群可爱善良优秀的青年人玩轮子的那些事儿!
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/chintdev" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/chintdev" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/7.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">npm机制</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="container content">

    
    <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/npm/">
                                <span class="chip bg-color">npm</span>
                            </a>
                        
                            <a href="/tags/node/">
                                <span class="chip bg-color">node</span>
                            </a>
                        
                            <a href="/tags/dependencies/">
                                <span class="chip bg-color">dependencies</span>
                            </a>
                        
                            <a href="/tags/script/">
                                <span class="chip bg-color">script</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/npm/" class="post-category">
                                npm
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2021-11-02
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2021-11-02
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    5.7k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    23 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h2 id="1-npm-install-机制"><a href="#1-npm-install-机制" class="headerlink" title="1. npm install 机制"></a>1. npm install 机制</h2><p>假设项目App中有如下三个依赖：</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"dependencies"</span>: {</span><br><span class="line">    <span class="attr">A</span>: <span class="string">"1.0.0"</span>,</span><br><span class="line">    <span class="attr">B</span>: <span class="string">"1.0.0"</span>,</span><br><span class="line">    <span class="attr">C</span>: <span class="string">"1.0.0"</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>A、B、C三个模块又有如下依赖：</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">A@<span class="number">1.0</span><span class="number">.0</span> -&gt; D@<span class="number">1.0</span><span class="number">.0</span></span><br><span class="line">B@<span class="number">1.0</span><span class="number">.0</span> -&gt; D@<span class="number">2.0</span><span class="number">.0</span></span><br><span class="line">C@<span class="number">1.0</span><span class="number">.0</span> -&gt; D@<span class="number">2.0</span><span class="number">.0</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="npm-2-x-时代-嵌套安装"><a href="#npm-2-x-时代-嵌套安装" class="headerlink" title="npm 2.x 时代 嵌套安装"></a>npm 2.x 时代 嵌套安装</h3><figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">├── node_modules</span><br><span class="line">│&nbsp;&nbsp; ├── A@<span class="number">1.0</span><span class="number">.0</span></span><br><span class="line">│&nbsp;&nbsp; │&nbsp;&nbsp; └── node_modules</span><br><span class="line">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; └── D@<span class="number">1.0</span><span class="number">.0</span></span><br><span class="line">│&nbsp;&nbsp; ├── B@<span class="number">1.0</span><span class="number">.0</span></span><br><span class="line">│&nbsp;&nbsp; │&nbsp;&nbsp; └── node_modules</span><br><span class="line">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; └── D@<span class="number">2.0</span><span class="number">.0</span></span><br><span class="line">│&nbsp;&nbsp; └── C@<span class="number">1.0</span><span class="number">.0</span></span><br><span class="line">│&nbsp;&nbsp; │&nbsp;&nbsp; └── node_modules</span><br><span class="line">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; └── D@<span class="number">2.0</span><span class="number">.0</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>优点：</p>
<ul>
<li>层级结构明显</li>
<li>简单的实现了多版本兼容</li>
<li>保证了对依赖包无论是安装还是删除都会有统一的行为和结构</li>
</ul>
<p>缺点：</p>
<ul>
<li>可能造成相同模块大量冗余问题</li>
<li>可能造成目录结构嵌套比较深的问题<h3 id="npm-3-x开始-扁平安装"><a href="#npm-3-x开始-扁平安装" class="headerlink" title="npm 3.x开始 -扁平安装"></a>npm 3.x开始 -扁平安装</h3><figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">├── node_modules</span><br><span class="line">│&nbsp;&nbsp; ├── A@<span class="number">1.0</span><span class="number">.0</span></span><br><span class="line">│&nbsp;&nbsp; │&nbsp;&nbsp; └── node_modules</span><br><span class="line">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; └── D@<span class="number">1.0</span><span class="number">.0</span></span><br><span class="line">│&nbsp;&nbsp; ├── B@<span class="number">1.0</span><span class="number">.0</span></span><br><span class="line">│&nbsp;&nbsp; ├── C@<span class="number">1.0</span><span class="number">.0</span></span><br><span class="line">│&nbsp;&nbsp; └── D@<span class="number">2.0</span><span class="number">.0</span></span><br></pre></td></tr></tbody></table></figure>
可以看到，<a href="mailto:D@2.0.0">D@2.0.0</a>模块被安装在一级node_modules中，而<a href="mailto:D@1.0.0">D@1.0.0</a>仍被安装在<a href="mailto:A@1.0.0">A@1.0.0</a>中。所以可以得出结论，<strong>在执行npm install安装时，如果遇到相同依赖的包，会优先将高版本（大版本）的包放在一级node_modules中，低版本的包则会按照npm 2.x的方式依次挂在依赖包的node_modules中。</strong></li>
</ul>
<p>再在项目中安装模块<a href="mailto:E@1.0.0">E@1.0.0</a>（依赖于模块<a href="mailto:D@1.0.0">D@1.0.0</a>），目录结构变为：</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">├── node_modules</span><br><span class="line">│&nbsp;&nbsp; ├── A@<span class="number">1.0</span><span class="number">.0</span></span><br><span class="line">│&nbsp;&nbsp; │&nbsp;&nbsp; └── node_modules</span><br><span class="line">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; └── D@<span class="number">1.0</span><span class="number">.0</span></span><br><span class="line">│&nbsp;&nbsp; ├── B@<span class="number">1.0</span><span class="number">.0</span></span><br><span class="line">│&nbsp;&nbsp; ├── C@<span class="number">1.0</span><span class="number">.0</span></span><br><span class="line">│&nbsp;&nbsp; ├── D@<span class="number">2.0</span><span class="number">.0</span></span><br><span class="line">│&nbsp;&nbsp; ├── E@<span class="number">1.0</span><span class="number">.0</span></span><br><span class="line">│&nbsp;&nbsp; │&nbsp;&nbsp; └── node_modules</span><br><span class="line">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; └── D@<span class="number">1.0</span><span class="number">.0</span></span><br></pre></td></tr></tbody></table></figure>
<p>再在项目中安装模块<a href="mailto:F@1.0.0">F@1.0.0</a>（依赖于模块<a href="mailto:D@2.0.0">D@2.0.0</a>），目录结构变为：</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">├── node_modules</span><br><span class="line">│&nbsp;&nbsp; ├── A@<span class="number">1.0</span><span class="number">.0</span></span><br><span class="line">│&nbsp;&nbsp; │&nbsp;&nbsp; └── node_modules</span><br><span class="line">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; └── D@<span class="number">1.0</span><span class="number">.0</span></span><br><span class="line">│&nbsp;&nbsp; ├── B@<span class="number">1.0</span><span class="number">.0</span></span><br><span class="line">│&nbsp;&nbsp; ├── C@<span class="number">1.0</span><span class="number">.0</span></span><br><span class="line">│&nbsp;&nbsp; ├── D@<span class="number">2.0</span><span class="number">.0</span></span><br><span class="line">│&nbsp;&nbsp; ├── E@<span class="number">1.0</span><span class="number">.0</span></span><br><span class="line">│&nbsp;&nbsp; │&nbsp;&nbsp; └── node_modules</span><br><span class="line">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; └── D@<span class="number">1.0</span><span class="number">.0</span></span><br><span class="line">│&nbsp;&nbsp; └── F@<span class="number">1.0</span><span class="number">.0</span></span><br></pre></td></tr></tbody></table></figure>
<p>可以看到，只会安装F模块。所以可以得出结论，<strong>在一级node_moudles中已经存在依赖包的情况下，新安装的依赖包如果不存在版本冲突，则会忽略安装</strong>。<br>从以上示例可以看出，npm 3.x并没有完美的解决npm 2.x中的问题，甚至还会退化到npm 2.x的行为。</p>
<h3 id="package-lock-json"><a href="#package-lock-json" class="headerlink" title="package-lock.json"></a>package-lock.json</h3><p>从npm 5.x开始，执行npm install时会自动生成一个<a href="https://link.juejin.cn/?target=https://docs.npmjs.com/files/package-lock.json">package-lock.json</a> 文件。<br>​</p>
<p>npm为了让开发者<strong>在安全的前提下使用最新的依赖包</strong>，在package.json中通常做了锁定大版本的操作，这样在每次npm install的时候都会拉取依赖包大版本下的最新的版本。这种机制最大的一个缺点就是当有依赖包有小版本更新时，可能会出现协同开发者的依赖包不一致的问题。</p>
<p>package-lock.json的详细描述主要由version、resolved、integrity、dev、requires、dependencies这几个字段构成</p>
<ul>
<li>version：包唯一的版本号</li>
<li>resolved：安装源</li>
<li>integrity：表明包完整性的hash值（验证包是否已失效）</li>
<li>dev：如果为true，则此依赖关系仅是顶级模块的开发依赖关系或者是一个的传递依赖关系</li>
<li>requires：依赖包所需要的所有依赖项，对应依赖包package.json里dependencies中的依赖项</li>
<li>dependencies：依赖包node_modules中依赖的包，与顶层的dependencies一样的结构<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"dependencies"</span>: {</span><br><span class="line">  <span class="string">"sass-loader"</span>: {</span><br><span class="line">    <span class="string">"version"</span>: <span class="string">"7.1.0"</span>,</span><br><span class="line">    <span class="string">"resolved"</span>: <span class="string">"http://registry.npm.taobao.org/sass-loader/download/sass-loader-7.1.0.tgz"</span>,</span><br><span class="line">    <span class="string">"integrity"</span>: <span class="string">"sha1-Fv1ROMuLQkv4p1lSihly1yqtBp0="</span>,</span><br><span class="line">    <span class="string">"dev"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"requires"</span>: {</span><br><span class="line">      <span class="string">"clone-deep"</span>: <span class="string">"^2.0.1"</span>,</span><br><span class="line">      <span class="string">"loader-utils"</span>: <span class="string">"^1.0.1"</span>,</span><br><span class="line">      <span class="string">"lodash.tail"</span>: <span class="string">"^4.1.1"</span>,</span><br><span class="line">      <span class="string">"neo-async"</span>: <span class="string">"^2.5.0"</span>,</span><br><span class="line">      <span class="string">"pify"</span>: <span class="string">"^3.0.0"</span>,</span><br><span class="line">      <span class="string">"semver"</span>: <span class="string">"^5.5.0"</span></span><br><span class="line">    },</span><br><span class="line">    <span class="string">"dependencies"</span>: {</span><br><span class="line">      <span class="string">"pify"</span>: {</span><br><span class="line">        <span class="string">"version"</span>: <span class="string">"3.0.0"</span>,</span><br><span class="line">        <span class="string">"resolved"</span>: <span class="string">"http://registry.npm.taobao.org/pify/download/pify-3.0.0.tgz"</span>,</span><br><span class="line">        <span class="string">"integrity"</span>: <span class="string">"sha1-5aSs0sEB/fPZpNB/DbxNtJ3SgXY="</span>,</span><br><span class="line">        <span class="string">"dev"</span>: <span class="literal">true</span></span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
package-lock.json文件和node_modules目录结构是一一对应的，即项目目录下存在package-lock.json可以让每次安装生成的依赖目录结构保持相同。<br>在开发一个应用时，建议把package-lock.json文件提交到代码版本仓库，从而让你的团队成员、运维部署人员或CI系统可以在执行npm install时安装的依赖版本都是一致的。<br>但是在开发一个库时，则不应把package-lock.json文件发布到仓库中。实际上，npm也默认不会把package-lock.json文件发布出去。之所以这么做，是因为库项目一般是被其他项目依赖的，在不写死的情况下，就可以复用主项目已经加载过的包，而一旦库依赖的是精确的版本号那么可能会造成包的冗余。<br>​</li>
</ul>
<h2 id="2-npm-中的依赖包"><a href="#2-npm-中的依赖包" class="headerlink" title="2. npm 中的依赖包"></a>2. npm 中的依赖包</h2><h3 id="依赖包分类"><a href="#依赖包分类" class="headerlink" title="依赖包分类"></a>依赖包分类</h3><ul>
<li><strong>dependencies - 业务依赖</strong></li>
<li><strong>devDependencies - 开发依赖</strong></li>
<li><strong>peerDependencies - 同伴依赖</strong></li>
<li><strong>bundledDependencies / bundleDependencies - 打包依赖</strong></li>
<li><strong>optionalDependencies - 可选依赖</strong></li>
</ul>
<p>作为npm的使用者，我们常用的依赖是dependencies和devDependencies，剩下三种依赖则是作为包的发布者才会使用到的字段。</p>
<h4 id="dependencies"><a href="#dependencies" class="headerlink" title="dependencies"></a><strong>dependencies</strong></h4><p>这种依赖在项目最终上线或者发布npm包时所需要，即其中的依赖项应该属于线上代码的一部分。比如框架vue，第三方的组件库element-ui等，这些依赖包都是必须装在这个选项里供生产环境使用。<br>通过命令npm install/i packageName -S/–save把包装在此依赖项里。如果没有指定版本，直接写一个包的名字，则安装当前npm仓库中这个包的最新版本。如果要指定版本的，可以把版本号写在包名后面，比如npm i <a href="mailto:vue@3.0.1">vue@3.0.1</a> -S。</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install/i packageName -S/--save</span><br><span class="line"></span><br><span class="line">// 从npm 5.x开始，可以不用手动添加-S/--save指令，直接执行npm i packageName把依赖包添加到dependencies中去。</span><br></pre></td></tr></tbody></table></figure>
<p>​</p>
<h4 id="devDependencies"><a href="#devDependencies" class="headerlink" title="devDependencies"></a><strong>devDependencies</strong></h4><p>这种依赖只在项目开发时所需要，即其中的依赖项不应该属于线上代码的一部分。比如构建工具webpack、gulp，预处理器babel-loader、scss-loader，测试工具e2e、chai等，这些都是辅助开发的工具包，无须在生产环境使用。</p>
<figure class="highlight erlang"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">npm install/i -D/--save-dev</span><br><span class="line">npm i --production // 线上机器（或者QA环境）上使用</span><br><span class="line"></span><br><span class="line">提示：千万别以为只有在dependencies中的模块才会被一起打包，而在devDependencies中的不会！模块能否被打包，取决于项目里是否被引入了该模块！</span><br></pre></td></tr></tbody></table></figure>
<p>在业务项目中dependencies和devDependencies没有什么本质区别，只是单纯的一个规范作用，在执行npm i时两个依赖下的模块都会被下载；而在发布npm包的时候，包中的dependencies依赖项在安装该包的时候会被一起下载，devDependencies依赖项则不会。</p>
<h4 id="peerDependencies"><a href="#peerDependencies" class="headerlink" title="peerDependencies"></a><strong>peerDependencies</strong></h4><p>这种依赖的作用是提示宿主环境去安装插件在peerDependencies中所指定依赖的包，然后插件所依赖的包永远都是宿主环境统一安装的npm包，最终解决插件与所依赖包不一致的问题。<br>这句话听起来可能有点拗口，举个例子来给大家说明下。<a href="mailto:element-ui@2.6.3">element-ui@2.6.3</a>只是提供一套基于vue的ui组件库，但它要求宿主环境需要安装指定的vue版本，所以你可以看到element项目中的package.json中具有一项配置：</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"peerDependencies"</span>: {</span><br><span class="line">    <span class="string">"vue"</span>: <span class="string">"^2.5.16"</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>它要求宿主环境安装3.0.0 &gt; vue@ &gt;= 2.5.16的版本，也就是element-ui的运行依赖宿主环境提供的该版本范围的vue依赖包<br>​</p>
<p>总结：大白话：如果你安装我，那么你最好也要按照我的要求安装A、B和C。</p>
<h4 id="bundledDependencies"><a href="#bundledDependencies" class="headerlink" title="**bundledDependencies **"></a>**bundledDependencies **</h4><p>这种依赖跟npm pack打包命令有关。假设package.json中有如下配置：</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">  <span class="string">"name"</span>: <span class="string">"font-end"</span>,</span><br><span class="line">  <span class="string">"version"</span>: <span class="string">"1.0.0"</span>,</span><br><span class="line">  <span class="string">"dependencies"</span>: {</span><br><span class="line">    <span class="string">"fe1"</span>: <span class="string">"^0.3.2"</span>,</span><br><span class="line">    ...</span><br><span class="line">  },</span><br><span class="line">  <span class="string">"devDependencies"</span>: {</span><br><span class="line">    ...</span><br><span class="line">    <span class="string">"fe2"</span>: <span class="string">"^1.0.0"</span></span><br><span class="line">  },</span><br><span class="line">  <span class="string">"bundledDependencies"</span>: [</span><br><span class="line">    <span class="string">"fe1"</span>,</span><br><span class="line">    <span class="string">"fe2"</span></span><br><span class="line">  ]</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>执行打包命令npm pack，会生成front-end-1.0.0.tgz压缩包，并且该压缩包中包含fe1和fe2两个安装包，这样使用者执行npm install front-end-1.0.0.tgz也会安装这两个依赖。<br>tips: 在bundledDependencies中指定的依赖包，必须先在dependencies和devDependencies声明过，否则打包会报错。</p>
<h4 id="optionalDependencies"><a href="#optionalDependencies" class="headerlink" title="optionalDependencies"></a><strong>optionalDependencies</strong></h4><p>这种依赖中的依赖项即使安装失败了，也不影响整个安装的过程。需要注意的是，如果一个依赖同时出现在dependencies和optionalDependencies中，那么optionalDependencies会获得更高的优先级，可能造成一些预期之外的效果，所以尽量要避免这种情况发生。<br>​</p>
<p>tips:  在实际项目中，如果某个包已经失效，我们通常会寻找它的替代者，或者换一个实现方案。不确定的依赖会增加代码判断和测试难度，所以这个依赖项还是尽量不要使用。</p>
<h3 id="依赖包版本号"><a href="#依赖包版本号" class="headerlink" title="依赖包版本号"></a>依赖包版本号</h3><p>npm采用了semver规范作为依赖版本管理方案。<br>​</p>
<p>一个npm依赖包的版本格式一般为：<strong>主版本号.次版本号.修订号</strong>（x.y.z），每个号的含义是：</p>
<ul>
<li><strong>主版本号</strong>（也叫大版本，major version）</li>
</ul>
<p>大版本的改动很可能是一次颠覆性的改动，也就意味着可能存在与低版本不兼容的API或者用法，（比如 vue 2 -&gt; 3)。</p>
<ul>
<li><strong>次版本号</strong>（也叫小版本，minor version）</li>
</ul>
<p>小版本的改动应当兼容同一个大版本内的API和用法，因此应该让开发者无感。所以我们通常只说大版本号，很少会精确到小版本号。<br>tips: 如果大版本号是 0 的话，表示软件处于开发初始阶段，一切都可能随时被改变，可能每个小版本之间也会存在不兼容性。所以在选择依赖时，尽量避开大版本号是 0 的包。</p>
<ul>
<li><strong>修订号</strong>（也叫补丁，patch）一般用于修复bug或者很细微的变更，也需要保持向前兼容。</li>
</ul>
<p>常见的几个版本格式如下：</p>
<ul>
<li><strong>“1.2.3”</strong></li>
</ul>
<p>表示精确版本号。任何其他版本号都不匹配。在一些比较重要的线上项目中，建议使用这种方式锁定版本。</p>
<ul>
<li><strong>“^1.2.3”</strong></li>
</ul>
<p>表示兼容补丁和小版本更新的版本号。官方的定义是“能够兼容除了最左侧的非 <strong>0</strong> 版本号之外的其他变化。</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"^1.2.3"</span> 等价于 <span class="string">"&gt;= 1.2.3 &lt; 2.0.0"</span>。即只要最左侧的 <span class="string">"1"</span> 不变，其他都可以改变。所以 <span class="string">"1.2.4"</span>, <span class="string">"1.3.0"</span> 都可以兼容。</span><br><span class="line"></span><br><span class="line"><span class="string">"^0.2.3"</span> 等价于 <span class="string">"&gt;= 0.2.3 &lt; 0.3.0"</span>。因为最左侧的是 <span class="string">"0"</span>，那么只要第二位 <span class="string">"2"</span> 不变，其他的都兼容，比如 <span class="string">"0.2.4"</span> 和 <span class="string">"0.2.99"</span>。</span><br><span class="line"></span><br><span class="line"><span class="string">"^0.0.3"</span> 等价于 <span class="string">"&gt;= 0.0.3 &lt; 0.0.4"</span>。大版本号和小版本号都为 <span class="string">"0"</span> ，所以也就等价于精确的 <span class="string">"0.0.3"</span>。</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><strong>“~1.2.3”</strong></li>
</ul>
<p>表示只兼容补丁更新的版本号。关于 ~ 的定义分为两部分：如果列出了小版本号（第二位），则只兼容补丁（第三位）的修改；如果没有列出小版本号，则兼容第二和第三位的修改。我们分两种情况理解一下这个定义：</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"~1.2.3"</span> 列出了小版本号 <span class="string">"2"</span>，因此只兼容第三位的修改，等价于 <span class="string">"&gt;= 1.2.3 &lt; 1.3.0"</span>。</span><br><span class="line"></span><br><span class="line"><span class="string">"~1.2"</span> 也列出了小版本号 <span class="string">"2"</span>，因此和上面一样兼容第三位的修改，等价于 <span class="string">"&gt;= 1.2.0 &lt; 1.3.0"</span>。</span><br><span class="line"></span><br><span class="line"><span class="string">"~1"</span> 没有列出小版本号，可以兼容第二第三位的修改，因此等价于 <span class="string">"&gt;= 1.0.0 &lt; 2.0.0"</span></span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><p><strong>“1.x” 、”1.X”、1.<em>“、”1”、”</em>“</strong></p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"*"</span> 、<span class="string">"x"</span> 或者 （空） 表示可以匹配任何版本。</span><br><span class="line"></span><br><span class="line"><span class="string">"1.x"</span>, <span class="string">"1.*"</span> 和 <span class="string">"1"</span> 表示匹配主版本号为 <span class="string">"1"</span> 的所有版本，因此等价于 <span class="string">"&gt;= 1.0.0 &lt; 2.0.0"</span>。</span><br><span class="line"></span><br><span class="line"><span class="string">"1.2.x"</span>, <span class="string">"1.2.*"</span> 和 <span class="string">"1.2"</span> 表示匹配版本号以 <span class="string">"1.2"</span> 开头的所有版本，因此等价于 <span class="string">"&gt;= 1.2.0 &lt; 1.3.0"</span>。</span><br></pre></td></tr></tbody></table></figure></li>
<li><p><strong>“1.2.3-alpha.1”、”1.2.3-beta.1”、”1.2.3-rc.1”</strong></p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">alpha(α)：预览版，或者叫内部测试版；一般不向外部发布，会有很多bug；一般只有测试人员使用。</span><br><span class="line"></span><br><span class="line">beta(β)：测试版，或者叫公开测试版；这个阶段的版本会一直加入新的功能；在alpha版之后推出。</span><br><span class="line"></span><br><span class="line">rc(release candidate)：最终测试版本；可能成为最终产品的候选版本，如果未出现问题则可发布成为正式版本。</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"~1.2.4-alpha.1"</span> 表示 <span class="string">"&gt;=1.2.4-alpha.1 &lt; 1.3.0"</span>。这样 <span class="string">"1.2.5"</span>, <span class="string">"1.2.4-alpha.2"</span> 都符合条件，而 <span class="string">"1.2.5-alpha.1"</span>, <span class="string">"1.3.0"</span> 不符合。</span><br><span class="line"></span><br><span class="line"><span class="string">"^1.2.4-alpha.1"</span> 表示 <span class="string">"&gt;=1.2.4-alpha.1 &lt; 2.0.0"</span>。这样 <span class="string">"1.2.5"</span>, <span class="string">"1.2.4-alpha.2"</span>, <span class="string">"1.3.0"</span> 都符合条件，而 <span class="string">"1.2.5-alpha.1"</span>, <span class="string">"2.0.0"</span> 不符合。</span><br><span class="line"></span><br><span class="line"><span class="comment">// &gt;1.2.4-alpha.1"表示接受 "1.2.4-alpha" 版本下所有大于 1 的预发布版本。因此 "1.2.4-alpha.7" 是符合要求的，但 "1.2.4-beta.1" 和 "1.2.5-alpha.2" 都不符合。此外如果是正式版本（不带预发布关键词），只要版本号符合要求即可，不检查预发布版本号，例如 "1.2.5", "1.3.0" 都是认可的。</span></span><br></pre></td></tr></tbody></table></figure>
<p>以包开发者的角度来考虑这个问题：假设当前线上版本是 “1.2.3”，如果我作了一些改动需要发布版本 “1.2.4”，但我不想直接上线（因为使用 “~1.2.3” 或者 “^1.2.3” 的用户都会直接静默更新），这就需要使用预发布功能。因此我可能会发布 “1.2.4-alpha.1” 或者 “1.2.4-beta.1” 等等。</p>
<h3 id="依赖包版本管理"><a href="#依赖包版本管理" class="headerlink" title="依赖包版本管理"></a>依赖包版本管理</h3></li>
</ul>
<ol>
<li><p>在大版本相同的前提下，如果一个模块在package.json中的小版本要<strong>大于</strong>package-lock.json中的小版本，则在执行npm install时，会将该模块更新到大版本下的最新的版本，并将版本号更新至package-lock.json。如果<strong>小于</strong>，则被package-lock.json中的版本锁定。</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// package-lock.json 中原版本</span></span><br><span class="line"><span class="string">"clipboard"</span>: {</span><br><span class="line">  <span class="string">"version"</span>: <span class="string">"1.5.10"</span>, </span><br><span class="line">},</span><br><span class="line"><span class="string">"vue"</span>: {</span><br><span class="line">  <span class="string">"version"</span>: <span class="string">"2.6.10"</span>,</span><br><span class="line">}</span><br><span class="line"><span class="comment">// package.json 中修改版本</span></span><br><span class="line"><span class="string">"dependencies"</span>: {</span><br><span class="line">  <span class="string">"clipboard"</span>: <span class="string">"^1.5.12"</span>,</span><br><span class="line">  <span class="string">"vue"</span>: <span class="string">"^2.5.6"</span></span><br><span class="line">  ...</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 执行完 npm install 后，package-lock.json 中</span></span><br><span class="line"><span class="string">"clipboard"</span>: {</span><br><span class="line">  <span class="string">"version"</span>: <span class="string">"1.7.1"</span>, <span class="comment">// 更新到大版本下的最新版本</span></span><br><span class="line">},</span><br><span class="line"><span class="string">"vue"</span>: {</span><br><span class="line">  <span class="string">"version"</span>: <span class="string">"2.6.10"</span>, <span class="comment">// 版本没发生改变</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li>
<li><p>如果一个模块在package.json和package-lock.json中的大版本不相同，则在执行npm install时，都将根据package.json中大版本下的最新版本进行更新，并将版本号更新至package-lock.json。</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// package-lock.json 中原版本</span></span><br><span class="line"><span class="string">"clipboard"</span>: {</span><br><span class="line">  <span class="string">"version"</span>: <span class="string">"2.0.4"</span>,</span><br><span class="line">}</span><br><span class="line"><span class="comment">// package.json 中修改版本</span></span><br><span class="line"><span class="string">"dependencies"</span>: {</span><br><span class="line">  <span class="string">"clipboard"</span>: <span class="string">"^1.6.1"</span>,</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 执行完npm install后，package-lock.json 中</span></span><br><span class="line"><span class="string">"clipboard"</span>: {</span><br><span class="line">  <span class="string">"version"</span>: <span class="string">"1.7.1"</span>, <span class="comment">// 更新到大版本下的最新版本</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li>
<li><p>如果一个模块在package.json中有记录，而在package-lock.json中无记录，执行npm install后，则会在package-lock.json生成该模块的详细记录。同理，一个模块在package.json中无记录，而在package-lock.json中有记录，执行npm install后，则会在package-lock.json删除该模块的详细记录。</p>
</li>
</ol>
<h2 id="3-npm-scripts-脚本"><a href="#3-npm-scripts-脚本" class="headerlink" title="3. npm scripts 脚本"></a>3. npm scripts 脚本</h2><p>package.json中的 <a href="https://link.juejin.cn/?target=https://docs.npmjs.com/misc/scripts">scripts</a> 字段可以用来自定义脚本命令，它的每一个属性，对应一段脚本。以vue-cli3为例：</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"scripts"</span>: {</span><br><span class="line">  <span class="string">"serve"</span>: <span class="string">"vue-cli-service serve"</span>,</span><br><span class="line">  ...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>这样就可以通过npm run serve脚本代替vue-cli-service serve脚本来启动项目，而无需每次敲一遍这么冗长的脚本。</p>
<h3 id="工作原理"><a href="#工作原理" class="headerlink" title="工作原理"></a>工作原理</h3><h4 id="package-json-中的-bin-字段"><a href="#package-json-中的-bin-字段" class="headerlink" title="package.json 中的 bin 字段"></a>package.json 中的 bin 字段</h4><p>package.json中的字段 <a href="https://link.juejin.cn/?target=https://docs.npmjs.com/files/package.json.html%23bin">bin</a> 表示的是一个<strong>可执行文件到指定文件源的映射</strong>。通过npm bin指令显示当前项目的bin目录的路径。例如在@vue/cli的package.json中：<br>例如:在chj-ip-tool的package.json中：<br><img src="https://cdn.nlark.com/yuque/0/2021/png/12582850/1634778717199-d5160d94-06bf-4a78-bc8b-cee18b0967e8.png#clientId=ubcbcb43a-f3df-4&amp;from=paste&amp;height=75&amp;id=u78df9db5&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=75&amp;originWidth=259&amp;originalType=binary&amp;ratio=1&amp;size=2649&amp;status=done&amp;style=none&amp;taskId=u3ca378d9-3c35-4301-a6b8-c398725a4a1&amp;width=259" alt="image.png"><br>全局安装:<br>如果全局安装chj-ip-tool的话， npm会在全局可执行bin文件安装目录            C:\Users\Administrator\AppData\Roaming\npm下创建一个指向C:\Users\Administrator\AppData\Roaming\npm\node_modules\chj-ip-tool\bin\cli.js文件的名为my-ip的软链接，这样就可以直接在终端输入my-ip来执行相关命令。<br><img src="https://cdn.nlark.com/yuque/0/2021/png/12582850/1629032050100-a436e440-cf65-4a1b-a1e8-88eae7c7d5d8.png#clientId=ue2a260f2-efff-4&amp;from=paste&amp;height=40&amp;id=u73dbfd80&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=62&amp;originWidth=907&amp;originalType=binary&amp;ratio=1&amp;size=29245&amp;status=done&amp;style=none&amp;taskId=u7f4aa3cd-80fb-439e-80b7-18c11e136b2&amp;width=588.4977722167969" alt="image.png"><br>局部安装:<br>如果局部安装chj-ip-tool的话，npm则会在本地项目./node_modules/.bin目录下创建一个指向./node_moudles/haijia-tool/bin/cli.js名为my-ip的软链接，这个时候如果想要执行my-ip命令有三种方式：</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> 直接输入.\node_modules\.bin\my-ip来执行。 </span><br><span class="line"><span class="number">2.</span> 使用npx vue命令来执行（npx 的作用就是为了方便调用项目内部安装的模块） 	</span><br><span class="line"><span class="number">3.</span> 使用npm run命令来执行（npm run会将当前项目的./node_modules/.bin的绝对路径加入全局环境变量中）</span><br></pre></td></tr></tbody></table></figure>
<h4 id="PATH-环境变量"><a href="#PATH-环境变量" class="headerlink" title="PATH 环境变量"></a>PATH 环境变量</h4><p>在terminal中执行命令时，<strong>命令会在PATH环境变量里包含的路径中去寻找相同名字的可执行文件</strong>。局部安装的包只在./node_modules/.bin中注册了它们的可执行文件，不会被包含在PATH环境变量中，这个时候在terminal中输入命令将会报无法找到的错误。<br><strong>那为什么通过npm run可以执行局部安装的命令行包呢？</strong><br>​</p>
<p>npm 脚本的原理非常简单。每当执行npm run，就会自动新建一个 Shell，在这个 Shell 里面执行指定的脚本命令。因此，只要是 Shell（一般是 Bash）可以运行的命令，就可以写在 npm 脚本里面。<br>比较特别的是，npm run新建的这个 Shell，会将当前目录的node_modules/.bin子目录加入PATH变量，执行结束后，再将PATH变量恢复原样。<br>我们来验证下这个说法。首先执行 cmd =&gt;path 查看当前所有的环境变量，可以看到PATH环境变量为：</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PATH=C:\Windows\system32;C:\Windows;C:\Windows\System32\Wbem;C:\Windows\System32\WindowsPowerShell\v1<span class="number">.0</span>\;C:\Windows\System32\OpenSSH\;D:\前端软件\Microsoft VS Code\bin;;D:\前端软件\Git\cmd;D:\前端软件\node\;C:\Users\ybchjia\AppData\Local\Microsoft\WindowsApps;C:\Users\ybchjia\AppData\Roaming\npm</span><br></pre></td></tr></tbody></table></figure>
<pre><code>再在当前项目下执行npm run env查看脚本运行时的环境变量，可以看到PATH环境变量为：
</code></pre>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Path=D:\前端软件\node\node_modules\npm\node_modules\npm-lifecycle\node-gyp-bin;D:\project-demo\ip-tool\node_modules\.bin;C:\Windows\system32;C:\Windows;C:\Windows\System32\Wbem;C:\Windows\System32\WindowsPowerShell\v1<span class="number">.0</span>\;C:\Windows\System32\OpenSSH\;D:\前端软 </span><br><span class="line">件\Microsoft VS Code\bin;;D:\前端软件\Git\cmd;D:\前端软件\node\;C:\Users\ybchjia\AppData\Local\Microsoft\WindowsApps;C:\Users\ybchjia\AppData\Roaming\npm</span><br></pre></td></tr></tbody></table></figure>
<p>这意味着，当前目录的node_modules/.bin子目录里面的所有脚本，都可以直接用脚本名调用，而不必加上路径。比如，当前项目的依赖里面有 Mocha，只要直接写mocha test就可以了。</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"test"</span>: <span class="string">"mocha test"</span></span><br><span class="line"><span class="string">"test"</span>: <span class="string">"./node_modules/.bin/mocha test"</span> <span class="comment">// 不必带上路径</span></span><br></pre></td></tr></tbody></table></figure>
<p>由于 npm 脚本的唯一要求就是可以在 Shell 执行，因此它不一定是 Node 脚本，任何可执行文件都可以写在里面。<br>npm 脚本的退出码，也遵守 Shell 脚本规则。如果退出码不是0，npm 就认为这个脚本执行失败。<br>​</p>
<p>PATH环境变量，是告诉系统，当要求系统运行一个程序而没有告诉它程序所在的完整路径时，系统除了在当前目录下面寻找此程序外，还应到哪些目录下去寻找。<br>​</p>
<h3 id="用法指南"><a href="#用法指南" class="headerlink" title="用法指南"></a>用法指南</h3><h4 id="传入参数"><a href="#传入参数" class="headerlink" title="传入参数"></a>传入参数</h4><p>node处理scripts参数其实很简单，比如：<br><img src="https://cdn.nlark.com/yuque/0/2021/png/12582850/1629032201141-537a223f-f405-4a01-989f-fd10365bc906.png#clientId=ue2a260f2-efff-4&amp;from=paste&amp;height=132&amp;id=u6bc9ef8c&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=150&amp;originWidth=631&amp;originalType=binary&amp;ratio=1&amp;size=24772&amp;status=done&amp;style=none&amp;taskId=u9e4d9430-50ea-428a-a084-4784028eb23&amp;width=553.4920349121094" alt="image.png"><br>除了第一个可执行的命令，以空格分割的任何字符串都是参数，并且都能通过process.argv属性访问。执行npm run serve3命令，process.argv的具体内容为：<br><img src="https://cdn.nlark.com/yuque/0/2021/png/12582850/1629032241556-ac230118-702b-4ca3-a0ea-f2e66fbaae7f.png#clientId=ue2a260f2-efff-4&amp;from=paste&amp;height=176&amp;id=u21b3f8d9&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=200&amp;originWidth=631&amp;originalType=binary&amp;ratio=1&amp;size=29444&amp;status=done&amp;style=none&amp;taskId=u1dbb903d-9093-4da8-aa23-7cfc9594ad1&amp;width=554.4859008789062" alt="image.png"><br>很多命令行包之所以这么写，都是依赖了 minimist 或者  yargs ，coa等参数解析工具来对命令行参数进行解析。以minimist对vue-cli-service serve –mode=dev –mobile -config build/example.js解析为例，解析后的结果为：<br><img src="https://cdn.nlark.com/yuque/0/2021/png/12582850/1629032274531-2b333d35-2c45-47c5-aa23-9589eff91557.png#clientId=ue2a260f2-efff-4&amp;from=paste&amp;height=84&amp;id=u5742ba09&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=167&amp;originWidth=777&amp;originalType=binary&amp;ratio=1&amp;size=11794&amp;status=done&amp;style=none&amp;taskId=ub57736d4-bd43-4121-8ea8-3599438e970&amp;width=388.5" alt="image.png"><br>我们还可以通过命令行传参的形式来进行参数传递：</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">npm run serve --params  <span class="comment">// 参数params将转化成process.env.npm_config_params = true</span></span><br><span class="line">npm run serve --params=<span class="number">123</span> <span class="comment">// 参数params将转化成process.env.npm_config_params = 123</span></span><br><span class="line">npm run serve -params  <span class="comment">// 等同于--params参数</span></span><br><span class="line"></span><br><span class="line">npm run serve -- --params  <span class="comment">// 将--params参数添加到process.argv数组中</span></span><br><span class="line">npm run serve params  <span class="comment">// 将params参数添加到process.argv数组中</span></span><br><span class="line">npm run serve -- params  <span class="comment">// 将params参数添加到process.argv数组中</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="多命令运行"><a href="#多命令运行" class="headerlink" title="多命令运行"></a>多命令运行</h4><h5 id="串行执行"><a href="#串行执行" class="headerlink" title="串行执行"></a>串行执行</h5><p>串行执行，要求前一个任务执行成功以后才能执行下一个任务，使用&amp;&amp;符号来连接。</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm run script1 &amp;&amp; npm run script2</span><br><span class="line">串行命令执行过程中，只要一个命令执行失败，则整个脚本终止。</span><br></pre></td></tr></tbody></table></figure>
<h5 id="并行执行"><a href="#并行执行" class="headerlink" title="并行执行"></a>并行执行</h5><p>并行执行，就是多个命令可以同时的平行执行，使用&amp;符号来连接。</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm run script1 &amp; npm run script2</span><br><span class="line"><span class="comment">// 这两个符号是Bash的内置功能。此外，还可以使用第三方的任务管理器模块：script-runner、npm-run-all、redrun。</span></span><br></pre></td></tr></tbody></table></figure>
<h2 id="4-实用技巧"><a href="#4-实用技巧" class="headerlink" title="4.实用技巧"></a>4.实用技巧</h2><h3 id="模块管理"><a href="#模块管理" class="headerlink" title="模块管理"></a>模块管理</h3><figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">npm list/ls &lt;packageName&gt;</span><br><span class="line"><span class="comment">// 检查当前项目依赖的所有模块，包括子模块以及子模块的子模块;</span></span><br><span class="line">  </span><br><span class="line">npm view/info &lt;packageName&gt; version</span><br><span class="line"><span class="comment">// 模块已经发布的最新的版本信息（不包括预发布版本）</span></span><br><span class="line"></span><br><span class="line">npm view/info &lt;packageName&gt; versions </span><br><span class="line"><span class="comment">// 模块所有的历史版本信息（包括预发布版本）</span></span><br><span class="line"></span><br><span class="line">npm view/info &lt;packageName&gt; &lt;package.json中的key值&gt; </span><br><span class="line"> // 还能查看package.json中字段对应的值</span><br><span class="line">  </span><br><span class="line">npm view/info &lt;packageName&gt;</span><br><span class="line">// 查看某个模块的所有信息，包括它的依赖、关键字、更新日期、贡献者、仓库地址和许可证等：</span><br><span class="line">  </span><br><span class="line">npm outdated</span><br><span class="line">// 查看当前项目中可升级的模块：</span><br></pre></td></tr></tbody></table></figure>
<h3 id="查看模块文档"><a href="#查看模块文档" class="headerlink" title="查看模块文档"></a>查看模块文档</h3><figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">打开模块的主页：npm home &lt;packageName&gt; </span><br></pre></td></tr></tbody></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2021/png/12582850/1629031781587-128c4c69-8fd0-46eb-aa47-9ac493bba51e.png#clientId=ue2a260f2-efff-4&amp;from=paste&amp;height=40&amp;id=ua9be24f4&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=42&amp;originWidth=419&amp;originalType=binary&amp;ratio=1&amp;size=2988&amp;status=done&amp;style=none&amp;taskId=u1ba823a5-c6a0-4b2b-8e05-7d71ffa0f4b&amp;width=396.4918670654297" alt="image.png"></p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">打开模块的代码仓库：npm repo &lt;packageName&gt; </span><br></pre></td></tr></tbody></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2021/png/12582850/1629031812795-184e7b19-ebcd-419d-922d-eff34ed70de5.png#clientId=ue2a260f2-efff-4&amp;from=paste&amp;height=70&amp;id=ua720c18e&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=98&amp;originWidth=569&amp;originalType=binary&amp;ratio=1&amp;size=6405&amp;status=done&amp;style=none&amp;taskId=ucfef75a1-157a-4f70-b349-a10fa3ffc20&amp;width=407.493896484375" alt="image.png"></p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">打开模块的 issues 地址：npm bugs &lt;packageName&gt;</span><br></pre></td></tr></tbody></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2021/png/12582850/1629031842936-4c11d87c-7132-4d06-b237-be77ee85ac9d.png#clientId=ue2a260f2-efff-4&amp;from=paste&amp;height=61&amp;id=ua2b9f783&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=77&amp;originWidth=543&amp;originalType=binary&amp;ratio=1&amp;size=4683&amp;status=done&amp;style=none&amp;taskId=u21710b30-ef8a-4bba-b6f3-50cacfb4dcf&amp;width=428.49822998046875" alt="image.png"></p>
<h3 id="本地开发模块调试"><a href="#本地开发模块调试" class="headerlink" title="本地开发模块调试"></a>本地开发模块调试</h3><p>方案一：本地打包引用     </p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">本地包：npm pack</span><br><span class="line">项目：npm i &lt; package &gt;（本地路径）</span><br></pre></td></tr></tbody></table></figure>
<p>方案二：npm发布引用</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i  &lt; packageName &gt;</span><br></pre></td></tr></tbody></table></figure>
<p>方案三：npm link（重点）    本地包：npm link这会创建一个软连接，并保存到目录<br>C:\Users\Administrator\AppData\Roaming\npm\node_modules 下面</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm link &lt; packageName &gt;</span><br></pre></td></tr></tbody></table></figure>
<p>这就将这个公共的项目通过软连接的方式引入到项目里面来了;<br>这时修改common项目下面的任意代码都会实时生效，不用打包，不用更新引入包，也不用重启。需要注意的是，当项目包依赖更新后，也就是执行了 npm install xxx 之后，需要重新link项目。</p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">chenhaijia</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="http://example.com/2021/11/02/npm%E6%9C%BA%E5%88%B6/">http://example.com/2021/11/02/npm%E6%9C%BA%E5%88%B6/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">chenhaijia</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/npm/">
                                    <span class="chip bg-color">npm</span>
                                </a>
                            
                                <a href="/tags/node/">
                                    <span class="chip bg-color">node</span>
                                </a>
                            
                                <a href="/tags/dependencies/">
                                    <span class="chip bg-color">dependencies</span>
                                </a>
                            
                                <a href="/tags/script/">
                                    <span class="chip bg-color">script</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.png" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    
        <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments textarea {
        box-sizing: border-box;
        background: url("/medias/comment_bg.png") 100% 100% no-repeat;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #4cbf30;
        font-weight: 500;
        text-decoration: none;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; padding-left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="vcomments" class="card-content" style="display: grid">
    </div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="/libs/valine/Valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        appId: 'mcP4qBSYxqDrqgNfVvVIJEQn-gzGzoHsz',
        appKey: 'CkYN9FWyHk60XyOiO2FDvazh',
        notify: 'false' === 'true',
        verify: 'false' === 'true',
        visitor: 'true' === 'true',
        avatar: 'mm',
        pageSize: '10',
        lang: 'zh-cn',
        placeholder: 'just go go'
    });
</script>

<!--酷Q推送-->


    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2021/11/02/10.29EventLoop/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/7.jpg" class="responsive-img" alt="事件机制">
                        
                        <span class="card-title">事件机制</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2021-11-02
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/EventLoop/" class="post-category">
                                    EventLoop
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/promise/">
                        <span class="chip bg-color">promise</span>
                    </a>
                    
                    <a href="/tags/async/">
                        <span class="chip bg-color">async</span>
                    </a>
                    
                    <a href="/tags/setTimeout/">
                        <span class="chip bg-color">setTimeout</span>
                    </a>
                    
                    <a href="/tags/synchronous/">
                        <span class="chip bg-color">synchronous</span>
                    </a>
                    
                    <a href="/tags/asynchronous/">
                        <span class="chip bg-color">asynchronous</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2021/11/02/hello-world/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/12.jpg" class="responsive-img" alt="Hello World">
                        
                        <span class="card-title">Hello World</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2021-11-02
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            chintdev
                            
                        </span>
                    </div>
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2019-2021</span>
            
            <a href="/about" target="_blank">chintdev</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
                &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                        class="white-color">11k</span>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/chintdev" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:ybzyh@chint.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=940642364" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 940642364" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    
        
        <script type="text/javascript">
            // 只在桌面版网页启用特效
            var windowWidth = $(window).width();
            if (windowWidth > 768) {
                document.write('<script type="text/javascript" src="/libs/others/sakura.js"><\/script>');
            }
        </script>
    

    <!-- 雪花特效 -->
    

    <!-- 鼠标星星特效 -->
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
        <div style="position:fixed;bottom:125px;right:16px;cursor: pointer;">
            <a title="兔小巢" target="_blank" rel="noopener" href="https://support.qq.com/products/363166"><i class="fa fa-comments fa-3x"  aria-hidden="true"></i></a>
        </div>
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"display":{"position":"left"},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>

</html>
